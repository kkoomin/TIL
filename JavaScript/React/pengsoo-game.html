<!-- Ball componentë¥¼ ëœë¤ ì¢Œí‘œì— ìƒì„±í•˜ê³ , í•´ë‹¹ Ballì„ ì •í•´ì§„ ì‹œê°„ ë‚´ì— ì¡ëŠ” ìˆ˜ë§Œí¼ Scoreë¥¼ ì¦ê°€ì‹œí‚¤ëŠ” ê²Œì„ -->
<!-- 
  * componentDidMount, componentDidUpdate, componentWillUnmount ì‚¬ìš©
  * propsë¡œ function ë³´ë‚´ê¸°ë¥¼ ì´ìš©í•´ì„œ child componentì—ì„œ parent componentì˜ stateë¥¼ ë³€ê²½
  * global varë¡œ setIntervalë¥¼ ì„¤ì •í•˜ê³  í•´ë‹¹ varë¡œ clearInterval ì‚¬ìš©
 -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <script
      crossorigin
      src="https://unpkg.com/react@16/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"
    ></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <style>
      html {
        margin: 0;
        font-family: sans-serif;
      }

      form {
        margin-bottom: 30px;
      }
      .input {
        width: 20px;
      }
      .header {
        height: 40px;
      }
      .overlay {
        background-color: SlateGray;
        position: relative;
        opacity: 0.2;
        z-index: 2;
        pointer-events: none; /* to remove any mouse interaction */
      }
    </style>
    <title>í­ìˆ˜ì¡ê¸°ê²Œì„</title>
  </head>

  <body>
    <div class="container"></div>
    <script type="text/babel">
      const container = document.querySelector(".container");
      class MyGamePanel extends React.Component {
        state = {
          balls: [],
          score: 0,
          time: 10,
          isGameStart: false
        };

        createBall = e => {
          e.preventDefault();
          let balls = [];
          for (let i = 0; i < this.input.value; i++) {
            const id = Math.random();
            balls.push(
              <Ball key={id} ballId={id} getTheScore={this.getTheScore} />
            );
          }
          this.setState({
            balls: balls,
            isGameStart: true
          });
          this.input.value = "";
        };

        getTheScore = () => {
          this.setState({
            score: this.state.score + 1
          });
        };

        finishGame = () => {
          this.setState({
            isGameStart: false,
            balls: [],
            score: 0
          });
          alert(`ê²Œì„ ë! í­ìˆ˜ë¥¼ ${this.state.score}ë§ˆë¦¬ ì¡ì•˜ë„¤ìš”!`);
        };

        setRef = ref => {
          this.input = ref;
        };

        render() {
          const divStyle = {
            backgroundColor: "lightblue",
            width: 1200,
            height: 700
          };

          return (
            <React.Fragment>
              <div>
                <h1>í­ìˆ˜ë¥¼ ì¡ì•„ë¼ ğŸ§</h1>
                <form onSubmit={this.createBall}>
                  <input
                    type="number"
                    placeholder="í­ìˆ˜ ëª‡ëª…? ğŸ§ğŸ§"
                    ref={this.setRef}
                    min="1"
                    max="20"
                  />
                  <button type="submit">ì‹œì‘</button>
                </form>
                <div className="score">Score: {this.state.score}</div>
                {this.state.isGameStart ? (
                  <Timer time={this.state.time} finishGame={this.finishGame} />
                ) : null}
              </div>
              <div style={divStyle} className="gamefield">
                {this.state.balls}
              </div>
            </React.Fragment>
          );
        }
      }

      class Timer extends React.Component {
        interval;
        state = {
          time: this.props.time
        };

        componentDidMount() {
          this.interval = setInterval(() => {
            this.setState({
              time: this.state.time - 1
            });
          }, 1000);
        }

        componentDidUpdate() {
          if (this.state.time === 0) {
            this.props.finishGame();
            clearInterval(this.interval);
          }
        }

        render() {
          return <div>Timer: {this.state.time}</div>;
        }
      }

      class Ball extends React.Component {
        interval;

        state = {
          ball_top: Math.random() * 600 + 160,
          ball_left: Math.random() * 1000 + 10,
          overlay: ""
        };

        componentDidMount() {
          //   console.log("Mounted!");
          this.interval = setInterval(this.changeBallPosition, 800);
        }
        componentWillUnmount() {
          clearInterval(this.interval);
        } // ì´ê±¸ ì•ˆí•´ì£¼ë©´ ì•ˆì¡ì€ í­ìˆ˜ë“¤ì˜ setInterval ì´ ê³„ì† ë.

        catchTheBall = () => {
          this.setState({
            overlay: "overlay"
          });
          clearInterval(this.interval); // ì¡ì€ í­ìˆ˜ë“¤ì˜ setIntervalì€ ì—¬ê¸°ì„œ clearë¨.
          this.props.getTheScore();
        };

        changeBallPosition = () => {
          this.setState({
            ball_top: Math.random() * 600 + 170,
            ball_left: Math.random() * 1000 + 10
          });
        };

        render() {
          const imgStyle = {
            width: 100,
            // height: 100,
            textAlign: "center",
            borderRadius: 50,
            backgroundColor: this.state.bgColor,
            position: "fixed",
            top: this.state.ball_top,
            left: this.state.ball_left
          };

          return (
            <img
              src="https://image.winudf.com/v2/image1/Y29tLmRldmJhbmQucGVuZ211bml0eV9pY29uXzE1NzYzOTc4NjhfMDY1/icon.png?w=340&fakeurl=1"
              style={imgStyle}
              onClick={this.catchTheBall}
              className={this.state.overlay}
            />
          );
        }
      }

      ReactDOM.render(<MyGamePanel />, container);
    </script>
  </body>
</html>
